import json
import csv

# Загрузка данных из файла JSON, если он существует
try:
    with open('game_data.json', 'r') as json_file:
        game_data = json.load(json_file)
except FileNotFoundError:
    game_data = []

person1 = {"name": "Алиса", "age": "18 лет"}
person2 = {"name": "Лена", "age": "17 лет"}

while True:
    person = input("Выберите персонажа (Алиса или Лена):")

    if person == "Алиса":
        values1 = person1["name"], person1["age"]
        print("Ваш персонаж:", values1)
    elif person == "Лена":
        values2 = person2["name"], person2["age"]
        print("Ваш персонаж:", values2)
    else:
        print("Введены недопустимые значения")
        continue
    break

print("Вы недавно переехали с родителями в другой город. Последний учебный год вам придется отучиться в новой школе, где вы никого не знаете. Для начала попробуйте завести новые знакомства.")
print("Куда отправитесь перед началом урока?")
place = ["библиотека", "школьный дворик", "столовая"]
print(place)

while True:
    mesto = input("Выберите место:")

    if mesto == "библиотека":
        print("В библиотеке сидел лишь один парень. Похоже он спит...")
        deistvie1 = ["попробовать разбудить его", "взять книгу"]
        print(deistvie1)
        vibor = input("Что сделать? ")

        if vibor == "попробовать разбудить его":
            print("Парень недовольно открыл глаза. \"Тебе нечем заняться? Лучше уйди отсюда\". Вы молча вышли из библиотеки и до начала урока сидели перед кабинетом.")
        elif vibor == "взять книгу":
            print("Взяв книгу, вы сидели и читали за соседним столом. К началу уроков парень проснулся и, улыбнувшись вам, вышел из библиотеки")
        else:
            print("Введены некорректные данные")
            continue
        break

    elif mesto == "школьный дворик":
        print("Вы вышли во двор и увидели двух парней, сидевших на скамейке")
        deistvie2 = ["подойти и познакомиться", "прогуляться по периметру школы"]
        print(deistvie2)
        vibor = input("Что сделать?")

        if vibor == "подойти и познакомиться":
            name1 = "Максим"
            name2 = "Саша"
            if person == "Алиса":
                print("Вы: \"Привет. Меня зовут Алиса. Я здесь первый день. Не против, если я составлю вам компанию?\"")
            elif person == "Лена":
                print("Вы: \"Привет. Меня зовут Лена. Я здесь первый день. Не против, если я составлю вам компанию?\"")
            print(f"Светловолосый парень: \"Привет. Нет, не против. Меня зовут {name1}, а это мой брат {name2}.\" {name2} оторвался от игры на телефоне и махнул вам рукой. Вы сидели и болтали до начала урока")
        elif vibor == "прогуляться по периметру школы":
            print("Из интересного вы нашли только оранжерею, и затем пошли на урок, так никого и не встретив")
        else:
            print("Введены некорректные данные")
            continue
        break

    elif mesto == "столовая":
        print("В столовой вы увидели двух девушек, которые сидели в самом углу и шептались")
        deistvie3 = ["пройти мимо", "подсесть к ним за столик"]
        print(deistvie3)
        vibor = input("Что сделать?")

        if vibor == "пройти мимо":
            print("Вы прошли мимо их столика и купили в буфете поесть. Попробовав еду, вы поняли, что лучше брать поесть из дома...")
        elif vibor == "подсесть к ним за столик":
            text = "\"кто тебя сюда звал? не видишь, что мы разговариваем?\""
            print(f"Брюнетка: {text.upper()}")
            print("Вы поняли, что лучше не связываться с этими истеричками. Точно не в первый день...")
        else:
            print("Введены некорректные данные")
            continue
        break

    else:
        print("Введены некорректные данные")
        continue

print("Прозвенел звонок, и вы отправились на уроки.")
print("На перемене вы вышли во двор и услышали крики.\nВы: \"Надо посмотреть, что там происходит.\"")
deistvie4 = ["проверить оранжерею", "выйти за калитку"]
print(deistvie4)

while True:
    vibor = input("Куда пойти?")

    if vibor == "проверить оранжерею":
        print("Пока вы дошли до оранжереи, голоса уже стихли")
        break

    elif vibor == "выйти за калитку":
        if mesto == "библиотека":
            print("Вы увидели парня, который спал в библиотеке перед уроками. Он ссорился с блондином, которого вы еще не встречали. Вы молча наблюдали издалека с толпой зевак. Вам еще предстоит узнать, что между ними произошло...")
        elif mesto != "библиотека":
            print("Вы увидели ссору двух парней. \nВы: \"Ничего интересного. Наверное девушку не поделили.\"")
        break

    else:
        print("Введены некорректные данные")
        continue

print("Вы пошли на следующий урок. Остаток дня прошел без происшествий, и вы пошли домой. Конец 1 эпизода.")

# Сохранение данных игры в формате JSON
game_data.append({
    "character": person,
    "location": mesto,
    "actions": [vibor],
    "outcome": "Конец 1 эпизода"
})
with open('game_data.json', 'w') as json_file:
    json.dump(game_data, json_file, indent=4)

# Запись данных игры в CSV файл
with open('game_data.csv', 'w', newline='') as csv_file:
    fieldnames = ["character", "location", "actions", "outcome"]
    writer = csv.DictWriter(csv_file, fieldnames=fieldnames)
    writer.writeheader()
    
    for data in game_data:
        writer.writerow(data)
